define(["require","exports","models/database","models/collection","models/collectionInfo","models/document","common/pagedResultSet"],function(n,t,i,r,u,f,e){var o=i,s=r,h=u,l=f,c=e;return function(){function n(){this.baseUrl=""}return n.prototype.databases=function(){var n=function(n){return n.map(function(n){return new o(n)})};return this.fetch("/databases",{pageSize:1024},null,n)},n.prototype.collections=function(){this.requireActiveDatabase();var t=function(n){return n.map(function(n){return new s(n)})};return this.fetch("/terms/Raven/DocumentsByEntityName",{field:"Tag",fromValue:"",pageSize:100},n.activeDatabase(),t)},n.prototype.collectionInfo=function(t,i,r){typeof i=="undefined"&&(i=0),typeof r=="undefined"&&(r=0),this.requireActiveDatabase();var u={query:t?"Tag:"+t:undefined,start:i,pageSize:r},f=function(n){return new h(n)};return this.fetch("/indexes/Raven/DocumentsByEntityName",u,n.activeDatabase(),f)},n.prototype.documents=function(n,t,i){typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=30),this.requireActiveDatabase();var r=$.Deferred();return this.collectionInfo(n,t,i).then(function(n){var t=n.results,i=new c(t,n.totalResults);r.resolve(i)}),r},n.prototype.requireActiveDatabase=function(){if(!n.activeDatabase())throw new Error("Must have an active database before calling this method.");},n.prototype.fetch=function(n,t,i,r){var u=$.ajax({cache:!1,url:this.baseUrl+(i&&i.isSystem===!1?"/databases/"+i.name:"")+n,data:t}),e,f;return u.fail(function(t){var i=t.responseText?t.responseText:"Error calling "+n;ko.postbox.publish("RavenError",i)}),e=null,r?(f=$.Deferred(),u.done(function(n){var t=r(n);f.resolve(t)}),f):u},n.activeDatabase=ko.observable().subscribeTo("ActivateDatabase"),n}()})
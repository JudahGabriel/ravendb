define(["require","exports","durandal/plugins/router","durandal/app","models/database","common/raven"],function(n,t,i,r,u,f){var e=i,o=r,s=u,h=f;return function(){function n(){var n=this;this.router=e,this.databases=ko.observableArray(),this.activeDatabase=ko.observable().subscribeTo("ActivateDatabase"),this.ravenDb=new h,ko.postbox.subscribe("RavenError",function(t){return n.onRavenError(t)})}return n.prototype.databasesLoaded=function(n){var t=new s("<system>");t.isSystem=!0,this.databases(n.concat([t])),this.databases()[0].activate()},n.prototype.activate=function(){var n=this;return this.ravenDb.databases().then(function(t){return n.databasesLoaded(t)}).then(function(){return e.activate("documents")})},n.prototype.onRavenError=function(n){o.showMessage(n,"RavenDb error")},n}()})
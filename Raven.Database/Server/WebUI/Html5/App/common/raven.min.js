define(["require","exports","models/database","models/collection","models/collectionInfo","models/document","common/pagedResultSet"],function(n,t,i,r,u,f,e){var s=i,h=r,c=u,o=f,l=e;return function(){function n(){this.baseUrl="http://localhost:8080"}return n.prototype.databases=function(){var n=function(n){return n.map(function(n){return new s(n)})};return this.fetch("/databases",{pageSize:1024},null,n)},n.prototype.collections=function(){this.requireActiveDatabase();var t=function(n){return n.map(function(n){return new h(n)})};return this.fetch("/terms/Raven/DocumentsByEntityName",{field:"Tag",fromValue:"",pageSize:100},n.activeDatabase(),t)},n.prototype.collectionInfo=function(t,i,r){typeof i=="undefined"&&(i=0),typeof r=="undefined"&&(r=0),this.requireActiveDatabase();var u={query:t?"Tag:"+t:undefined,start:i,pageSize:r},f=function(n){return new c(n)};return this.fetch("/indexes/Raven/DocumentsByEntityName",u,n.activeDatabase(),f)},n.prototype.documents=function(n,t,i){typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=30),this.requireActiveDatabase();var r=$.Deferred();return this.collectionInfo(n,t,i).then(function(n){var t=n.results,i=new l(t,n.totalResults);r.resolve(i)}),r},n.prototype.document=function(t){var i=function(n){return new o(n)},r="/docs/"+encodeURIComponent(t);return this.fetch(r,null,n.activeDatabase(),i)},n.prototype.documentWithMetadata=function(t){var i=function(n){return new o(n[0])},r={startsWith:t,start:0,pageSize:1};return this.fetch("/docs/",r,n.activeDatabase(),i)},n.prototype.deleteDocuments=function(t){var i=this,r=t.map(function(n){return i.createDeleteDocument(n)});return this.post("/bulk_docs",ko.toJSON(r),n.activeDatabase())},n.prototype.saveDocument=function(t){var i={"Raven-Client-Version":"2.5.0.0","Raven-Entity-Name":t.__metadata.ravenEntityName,"Raven-Clr-Type":t.__metadata.ravenClrType,"If-None-Match":t.__metadata.etag},r=JSON.stringify(t.toDto()),u="/docs/"+t.__metadata.id;return this.put(u,r,n.activeDatabase(),i)},n.prototype.createDeleteDocument=function(n){return{Key:n,Method:"DELETE",Etag:null,AdditionalData:null}},n.prototype.requireActiveDatabase=function(){if(!n.activeDatabase())throw new Error("Must have an active database before calling this method.");},n.prototype.fetch=function(n,t,i,r){var f=this.ajax(n,t,"GET",i),u;return r?(u=$.Deferred(),f.done(function(n){var t=r(n);u.resolve(t)}),f.fail(function(n,t,i){return u.reject(n,t,i)}),u):f},n.prototype.post=function(n,t,i,r){return this.ajax(n,t,"POST",i,r)},n.prototype.put=function(n,t,i,r){return this.ajax(n,t,"PUT",i,r)},n.prototype.ajax=function(n,t,i,r,u){var f={cache:!1,url:this.baseUrl+(r&&r.isSystem===!1?"/databases/"+r.name:"")+n,data:t,type:i,beforeSend:undefined};return u&&(f.beforeSend=function(n){for(var t in u)f[t]=u[t],n.setRequestHeader(t,f[t])}),$.ajax(f)},n.activeDatabase=ko.observable().subscribeTo("ActivateDatabase"),n}()})
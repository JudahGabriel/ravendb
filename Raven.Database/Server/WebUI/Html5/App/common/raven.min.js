define(["require","exports","models/database","models/collection","models/collectionInfo","models/document","common/pagedResultSet"],function(n,t,i,r,u,f,e){var o=i,s=r,h=u,l=f,c=e;return function(){function n(){this.baseUrl="http://localhost:8080"}return n.prototype.databases=function(){var n=function(n){return n.map(function(n){return new o(n)})};return this.fetch("/databases",{pageSize:1024},null,n)},n.prototype.collections=function(){this.requireActiveDatabase();var t=function(n){return n.map(function(n){return new s(n)})};return this.fetch("/terms/Raven/DocumentsByEntityName",{field:"Tag",fromValue:"",pageSize:100},n.activeDatabase(),t)},n.prototype.collectionInfo=function(t,i,r){typeof i=="undefined"&&(i=0),typeof r=="undefined"&&(r=0),this.requireActiveDatabase();var u={query:t?"Tag:"+t:undefined,start:i,pageSize:r},f=function(n){return new h(n)};return this.fetch("/indexes/Raven/DocumentsByEntityName",u,n.activeDatabase(),f)},n.prototype.documents=function(n,t,i){typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=30),this.requireActiveDatabase();var r=$.Deferred();return this.collectionInfo(n,t,i).then(function(n){var t=n.results,i=new c(t,n.totalResults);r.resolve(i)}),r},n.prototype.deleteDocuments=function(t){var r=this,i;return this.requireActiveDatabase(),i=t.map(function(n){return r.createDeleteDocument(n)}),this.post("/bulk_docs",ko.toJSON(i),n.activeDatabase())},n.prototype.createDeleteDocument=function(n){return{Key:n,Method:"DELETE",Etag:null,AdditionalData:null}},n.prototype.requireActiveDatabase=function(){if(!n.activeDatabase())throw new Error("Must have an active database before calling this method.");},n.prototype.fetch=function(n,t,i,r){var f=this.ajax(n,t,"GET",i),u;return r?(u=$.Deferred(),f.done(function(n){var t=r(n);u.resolve(t)}),u):f},n.prototype.post=function(n,t,i,r){return this.ajax(n,t,"POST",i,r)},n.prototype.ajax=function(n,t,i,r,u){var o={cache:!1,url:this.baseUrl+(r&&r.isSystem===!1?"/databases/"+r.name:"")+n,data:t,type:i},f,e;if(u)for(f in u)o[f]=u[f];return e=$.ajax(o),e.fail(function(t){var i=t.responseText?t.responseText:"Error calling "+n;ko.postbox.publish("RavenError",i)}),e},n.activeDatabase=ko.observable().subscribeTo("ActivateDatabase"),n}()})
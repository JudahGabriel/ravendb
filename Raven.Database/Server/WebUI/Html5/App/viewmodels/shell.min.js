define(["require","exports","durandal/plugins/router","durandal/app","durandal/system","models/database","common/raven"],function(n,t,i,r,u,f,e){var o=i,s=r,h=u,c=f,l=e;return function(){function n(){var n=this;this.router=o,this.databases=ko.observableArray(),this.activeDatabase=ko.observable().subscribeTo("ActivateDatabase"),this.ravenDb=new l,ko.postbox.subscribe("EditDocument",function(t){return n.launchDocEditor(t.doc.getId())})}return n.prototype.databasesLoaded=function(n){var t=new c("<system>");t.isSystem=!0,this.databases(n.concat([t])),this.databases()[0].activate()},n.prototype.activate=function(){var n=this;return this.ravenDb.databases().fail(function(n){h.log("Unable to connect to Raven.",n),s.showMessage("Couldn't connect to Raven. Details in the browser console.",":-(",["Dismiss"]),$(".splash").hide()}).then(function(t){return n.databasesLoaded(t)}).then(function(){return o.activate("documents")})},n.prototype.launchDocEditor=function(n){o.navigateTo("#edit?id="+encodeURIComponent(n))},n}()})